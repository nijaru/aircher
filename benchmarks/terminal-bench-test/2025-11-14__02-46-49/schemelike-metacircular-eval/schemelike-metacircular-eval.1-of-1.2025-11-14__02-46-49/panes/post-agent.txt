root@85d385b93e71:/app# cat > eval.scm << 'EOF'
> (define (eval-program)
>   (define program-file (read-line))
>   (define program-code (read-file program-file))
>   (define (eval-expr expr env)
>     (cond
>       ((number? expr) expr)
>       ((symbol? expr) (lookup expr env))
>       ((not (pair? expr)) expr)
>       ((eq? (car expr) 'quote) (cadr expr))
>       ((eq? (car expr) 'if)
>        (if (eval-expr (cadr expr) env)
>            (eval-expr (caddr expr) env)
>            (eval-expr (cadddr expr) env)))
>       ((eq? (car expr) 'define)
>        (set! env (extend-env (cadr expr) (eval-expr (caddr expr) env) env))
>        'ok)
>       ((eq? (car expr) 'lambda)
>        (list 'closure (cadr expr) (caddr expr) env))
>       ((eq? (car expr) 'begin)
>        (eval-sequence (cdr expr) env))
>       (else (apply-proc (eval-expr (car expr) env)
>                         (map (lambda (arg) (eval-expr arg env)) (cdr expr))))))
>   (define (apply-proc proc args)
>     (cond
>       ((primitive? proc) (apply-primitive proc args))
>       ((eq? (car proc) 'closure)
>        (eval-expr (caddr proc)
>                   (extend-env* (cadr proc) args (cadddr proc))))))
>   (define (eval-sequence exprs env)
>     (if (null? (cdr exprs))
>         (eval-expr (car exprs) env)
>         (begin (eval-expr (car exprs) env)
>                (eval-sequence (cdr exprs) env))))
>   (define initial-env
>     (list (cons '+ +) (cons '- -) (cons '* *) (cons '/ /)
>           (cons '= =) (cons '< <) (cons '> >)
>           (cons 'cons cons) (cons 'car car) (cons 'cdr cdr)
>           (cons 'null? null?) (cons 'pair? pair?) (cons 'number? number?)
>           (cons 'symbol? symbol?) (cons 'eq? eq?)
>           (cons 'display display) (cons 'newline newline)
>           (cons 'read read) (cons 'read-line read-line)))
>   (eval-expr program-code initial-env))
> (eval-program)
> EOF; tmux wait -S done
>
